name: post-tweet-with-video
description: Post tweet with video to Twitter (supports MP4/MOV up to 512MB)

instructions: |
  # Post Tweet with Video Workflow

  This workflow posts a tweet with a video to Twitter using the Twitter API Premium Client.

  ## Steps

  ### 1. Gather Tweet Text

  Ask the user for the tweet text:
  - "What would you like to say with your video?"
  - "Text is optional but recommended for context"

  **Store as**: `tweet_text`

  ### 2. Gather Video Path

  Ask for video file path:
  - "Provide the path to your video file"
  - "Supported formats: MP4, MOV"
  - "Max size: 512MB"
  - "Max duration: Varies by account (typically 2-10 minutes)"

  **Important**: Must be ABSOLUTE path, not relative!

  Example paths:
  - `/Users/username/Desktop/video.mp4`
  - `/Users/sid/Desktop/project/outputs/scene_01.mp4`

  **Store as**: `video_path`

  ### 3. Optional: Ask for Alt Text

  For accessibility:
  - "Would you like to add alt text/description for your video? [yes/no]"

  **Store as**: `alt_text`

  ### 4. Validate Video

  ```javascript
  import { existsSync } from 'fs';
  import { stat } from 'fs/promises';

  const errors = [];

  // Check exists
  if (!existsSync(video_path)) {
    errors.push(`Video not found: ${video_path}`);
  } else {
    // Check size
    const stats = await stat(video_path);
    const sizeMB = stats.size / (1024 * 1024);

    if (sizeMB > 512) {
      errors.push(`Video too large: ${sizeMB.toFixed(2)}MB (max 512MB)`);
    }

    // Check format
    const ext = video_path.toLowerCase().split('.').pop();
    const validFormats = ['mp4', 'mov'];
    if (!validFormats.includes(ext)) {
      errors.push(`Video format invalid: .${ext} (use MP4 or MOV)`);
    }

    console.log(`Video file: ${sizeMB.toFixed(2)} MB`);
  }

  if (errors.length > 0) {
    console.log('✗ Validation errors:');
    errors.forEach(error => console.log(`  - ${error}`));
    // Stop and ask user to fix issues
    return;
  }
  ```

  ### 5. Show Preview

  ```
  Preview:
  ─────────────────────────────────────────
  Text: [tweet_text]
  Video: /path/to/video.mp4 (X.X MB)
  Alt Text: [if provided]
  ─────────────────────────────────────────
  Note: Video upload may take a moment...
  ```

  Ask for confirmation: "Post this tweet with video? [yes/no]"

  ### 6. Post Tweet with Video

  ```javascript
  import { TwitterClient } from './bmad/modules/twitter-api-client/index.js';

  const client = new TwitterClient();

  console.log('Uploading video...');
  console.log('This may take a moment for large files...');

  const result = await client.createTweet({
    text: tweet_text,
    media: [{
      path: video_path,
      altText: alt_text
    }]
  });

  if (result.success) {
    console.log('✓ Tweet with video posted successfully!');
    console.log();
    console.log('Details:');
    console.log(`  Tweet ID: ${result.id}`);
    console.log(`  URL: ${result.url}`);
    console.log(`  Video: Uploaded and processing`);
    console.log(`  Length: ${result.text.length} characters`);
    console.log();
    console.log('Note: Video may still be processing on Twitter');
    console.log(`View your tweet: ${result.url}`);

    // Update rate limits
    const stats = client.getRateLimitStats();
    console.log();
    console.log('Updated Rate Limits:');
    console.log(`  Monthly: ${stats.remaining.monthly} remaining`);
    console.log(`  Daily: ${stats.remaining.daily} remaining`);
    console.log(`  Hourly: ${stats.remaining.hourly} remaining`);
  } else {
    console.log('✗ Failed to post tweet with video');
    console.log(`  Error: ${result.error}`);

    // Provide helpful guidance
    if (result.error.includes('Media upload failed')) {
      console.log();
      console.log('Solution: Check video file and try again');
      console.log('  - Verify file path is absolute (not relative)');
      console.log('  - Check file size (max 512MB)');
      console.log('  - Check file format (MP4 or MOV)');
      console.log('  - Ensure file is readable');
      console.log('  - Try with a smaller video first');
    } else if (result.error.includes('Validation failed')) {
      console.log();
      console.log('Solution: Fix validation errors and try again');
      console.log('  - Only 1 video per tweet (cannot mix with images)');
      console.log('  - Supported formats: MP4, MOV');
      console.log('  - Max size: 512MB');
      console.log('  - Video encoding: H.264 recommended');
    }
  }
  ```

  ## Example Usage

  ```
  User: "I want to post a video"

  Agent: "What would you like to say with your video?"

  User: "Check out this demo of our new feature!"

  Agent: "Provide the path to your video file (MP4 or MOV, max 512MB)"

  User: "/Users/sid/Desktop/demo-video.mp4"

  Agent: "Would you like to add alt text/description? [yes/no]"

  User: "yes"

  Agent: "Describe the video (for accessibility):"

  User: "Screen recording showing new dashboard features"

  Agent:
  Preview:
  ─────────────────────────────────────────
  Text: Check out this demo of our new feature!
  Video: /Users/sid/Desktop/demo-video.mp4 (45.2 MB)
  Alt Text: Screen recording showing new dashboard features
  ─────────────────────────────────────────
  Note: Video upload may take a moment...

  Post this tweet with video? [yes/no]

  User: "yes"

  Agent: "Uploading video..."
         "This may take a moment for large files..."

  ✓ Tweet with video posted successfully!

  Details:
    Tweet ID: 1234567890
    URL: https://twitter.com/user/status/1234567890
    Video: Uploaded and processing
    Length: 43 characters

  Note: Video may still be processing on Twitter
  View your tweet: https://twitter.com/user/status/1234567890
  ```

  ## Video Upload Process

  ### How It Works

  1. **Chunked Upload**: Large videos are split into chunks
  2. **INIT**: Initialize upload session with Twitter
  3. **APPEND**: Upload chunks sequentially (handled automatically)
  4. **FINALIZE**: Complete upload and start processing
  5. **STATUS**: Wait for processing to complete (handled automatically)
  6. **Tweet**: Create tweet with processed video

  The `twitter-api-v2` library handles all of this automatically!

  ### Processing Times

  - Small videos (< 10MB): ~5-10 seconds
  - Medium videos (10-100MB): ~15-30 seconds
  - Large videos (100-512MB): ~1-5 minutes

  Twitter processes the video after upload. The tweet will appear immediately, but the video may show "Processing..." briefly.

  ## Video Specifications

  ### Supported Formats
  - **MP4** (recommended)
  - **MOV**

  ### Encoding Recommendations
  - **Codec**: H.264 (most compatible)
  - **Frame Rate**: 30-60 fps
  - **Resolution**: 32x32 to 1280x1024
  - **Aspect Ratio**: Any (Twitter auto-crops)
  - **Audio**: AAC recommended

  ### File Size Limits
  - **Maximum**: 512 MB
  - **Recommended**: < 100 MB for faster upload

  ### Duration Limits
  - **Free accounts**: Typically 2 minutes 20 seconds
  - **Verified accounts**: Up to 10 minutes
  - **Premium accounts**: Check your account limits

  ## Tips for Users

  1. **Compress Videos**: Use H.264 codec for smaller files
  2. **Test First**: Try with a small video first
  3. **Be Patient**: Large videos take time to upload
  4. **Check Format**: MP4 is most reliable
  5. **Optimize**: Lower resolution = faster upload

  ## Common Issues

  ### "File not found"
  - Path must be absolute, not relative
  - Check for typos in path
  - Ensure file exists at that location

  ### "Video too large"
  - Compress video to reduce size
  - Use H.264 codec with lower bitrate
  - Consider splitting into multiple tweets

  ### "Media upload failed"
  - File may be corrupted
  - Format may not be supported
  - Check video encoding

  ### "Processing timeout"
  - Video is very large
  - Twitter's processing queue is busy
  - Video should appear eventually

  ## Constraints

  - **Cannot mix videos with images**: 1 video OR up to 4 images
  - **One video per tweet**: Cannot attach multiple videos
  - **Processing delay**: Video may take time to appear
  - **Duration limits**: Depend on account type

  ## Notes

  - Video upload uses Twitter v1.1 API (chunked upload)
  - Tweet creation uses Twitter v2 API
  - Both operations handled automatically
  - Rate limits apply to all tweet types
  - Video processing happens on Twitter's servers
  - Alt text is optional but recommended
